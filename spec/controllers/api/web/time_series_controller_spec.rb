require 'rails_helper'

RSpec.describe Api::Web::TimeSeriesController, type: :controller do
  # ActionCableのモック
  before do
    allow(ActionCable.server).to receive(:broadcast)
  end

  # --- 調査用テスト (既存) ---
  describe 'POST #generate_polyphonic combinations' do
    # ... (省略: 前回のコードと同じ) ...
  end

  # --- 検証用テスト (今回追加) ---
  describe 'Verified Scenarios' do
    let(:initial_octaves) { [[0, 7], [0, 7], [0, 7]] }
    let(:stream_counts)   { [2] }
    let(:job_id)          { 'test-job-id' }
    # target_continuations「ストリームの持続度（生成ステップ数の基準）」
    #       global_complexity 「和音進行の『裏切り度合い』」
    #            stream_complexity_center「各声部の平均的な『運動量（激しさ）』」
    #                 complexity_group_count「ストリームをいくつの『派閥（グループ）』に分けるか」
    #                    complexity_diversity「派閥ごとの『キャラの濃さ（対比）』」
    #                         group_concordance「同じ派閥内の『音の密集度（物理的なユニゾン度）』」
    [
      # [0.0, 0.0, 0.0, 1, 0.0, 0.0, [0, 7]],
      # [0.0, 0.0, 0.0, 1, 0.0, 0.5, [0, 7]],
      # [0.0, 0.0, 0.0, 1, 0.0, 1.0, [0, 7]],
      # [0.0, 0.0, 0.0, 1, 0.5, 0.0, [0, 7]],
      # [0.0, 0.0, 0.0, 1, 0.5, 0.5, [0, 7]],
      # [0.0, 0.0, 0.0, 1, 0.5, 1.0, [0, 7]],
      # [0.0, 0.0, 0.0, 1, 1.0, 0.0, [0, 7]],
      # [0.0, 0.0, 0.0, 1, 1.0, 0.5, [0, 7]],
      # [0.0, 0.0, 0.0, 1, 1.0, 1.0, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 0.0, 0.0, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 0.0, 0.5, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 0.0, 1.0, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 0.5, 0.0, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 0.5, 0.5, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 0.5, 1.0, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 1.0, 0.0, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 1.0, 0.5, [0, 7]],
      # [0.0, 0.0, 0.0, 2, 1.0, 1.0, [0, 7]],
      # [0.0, 0.0, 0.5, 1, 0.0, 0.0, [0, 7]],
      # [0.0, 0.0, 0.5, 1, 0.0, 0.5, [2, 3]],
      [0.0, 0.0, 0.5, 1, 0.0, 1.0, [2, 3]],
      # [0.0, 0.0, 0.5, 1, 0.5, 0.0, [0, 7]],
      # [0.0, 0.0, 0.5, 1, 0.5, 0.5, [2, 3]],
      # [0.0, 0.0, 0.5, 1, 0.5, 1.0, [2, 3]],
      # [0.0, 0.0, 0.5, 1, 1.0, 0.0, [0, 7]],
      # [0.0, 0.0, 0.5, 1, 1.0, 0.5, [2, 3]],
      # [0.0, 0.0, 0.5, 1, 1.0, 1.0, [2, 3]],
      # [0.0, 0.0, 0.5, 2, 0.0, 0.0, [0, 7]],
      # [0.0, 0.0, 0.5, 2, 0.0, 0.5, [0, 7]],
      # [0.0, 0.0, 0.5, 2, 0.0, 1.0, [0, 7]],
      # [0.0, 0.0, 0.5, 2, 0.5, 0.0, [0, 7]],
      # [0.0, 0.0, 0.5, 2, 0.5, 0.5, [0, 7]],
      # [0.0, 0.0, 0.5, 2, 0.5, 1.0, [0, 7]],
      # [0.0, 0.0, 0.5, 2, 1.0, 0.0, [0, 7]],
      # [0.0, 0.0, 0.5, 2, 1.0, 0.5, [0, 7]],
      # [0.0, 0.0, 0.5, 2, 1.0, 1.0, [0, 7]],
      # [0.0, 0.0, 1.0, 1, 0.0, 0.0, [0, 7]],
      # [0.0, 0.0, 1.0, 1, 0.0, 0.5, [0, 1]],
      # [0.0, 0.0, 1.0, 1, 0.0, 1.0, [0, 1]],
      # [0.0, 0.0, 1.0, 1, 0.5, 0.0, [0, 7]],
      # [0.0, 0.0, 1.0, 1, 0.5, 0.5, [0, 1]],
      # [0.0, 0.0, 1.0, 1, 0.5, 1.0, [0, 1]],
      # [0.0, 0.0, 1.0, 1, 1.0, 0.0, [0, 7]],
      # [0.0, 0.0, 1.0, 1, 1.0, 0.5, [0, 1]],
      # [0.0, 0.0, 1.0, 1, 1.0, 1.0, [0, 1]],
      # [0.0, 0.0, 1.0, 2, 0.0, 0.0, [0, 7]],
      # [0.0, 0.0, 1.0, 2, 0.0, 0.5, [0, 7]],
      # [0.0, 0.0, 1.0, 2, 0.0, 1.0, [0, 7]],
      # [0.0, 0.0, 1.0, 2, 0.5, 0.0, [0, 7]],
      # [0.0, 0.0, 1.0, 2, 0.5, 0.5, [0, 7]],
      # [0.0, 0.0, 1.0, 2, 0.5, 1.0, [0, 7]],
      # [0.0, 0.0, 1.0, 2, 1.0, 0.0, [0, 7]],
      # [0.0, 0.0, 1.0, 2, 1.0, 0.5, [0, 7]],
      # [0.0, 0.0, 1.0, 2, 1.0, 1.0, [0, 7]],
      # [0.0, 0.5, 0.0, 1, 0.0, 0.0, [0, 6]],
      # [0.0, 0.5, 0.0, 1, 0.0, 0.5, [0, 6]],
      # [0.0, 0.5, 0.0, 1, 0.0, 1.0, [0, 1]],
      # [0.0, 0.5, 0.0, 1, 0.5, 0.0, [0, 6]],
      # [0.0, 0.5, 0.0, 1, 0.5, 0.5, [0, 6]],
      # [0.0, 0.5, 0.0, 1, 0.5, 1.0, [0, 1]],
      # [0.0, 0.5, 0.0, 1, 1.0, 0.0, [0, 6]],
      # [0.0, 0.5, 0.0, 1, 1.0, 0.5, [0, 6]],
      # [0.0, 0.5, 0.0, 1, 1.0, 1.0, [0, 1]],
      # [0.0, 0.5, 0.0, 2, 0.0, 0.0, [0, 6]],
      # [0.0, 0.5, 0.0, 2, 0.0, 0.5, [0, 6]],
      # [0.0, 0.5, 0.0, 2, 0.0, 1.0, [0, 6]],
      # [0.0, 0.5, 0.0, 2, 0.5, 0.0, [0, 5]],
      # [0.0, 0.5, 0.0, 2, 0.5, 0.5, [0, 5]],
      # [0.0, 0.5, 0.0, 2, 0.5, 1.0, [0, 5]],
      # [0.0, 0.5, 0.0, 2, 1.0, 0.0, [0, 3]],
      # [0.0, 0.5, 0.0, 2, 1.0, 0.5, [0, 3]],
      # [0.0, 0.5, 0.0, 2, 1.0, 1.0, [0, 3]],
      # [0.0, 0.5, 0.5, 1, 0.0, 0.0, [2, 3]],
      # [0.0, 0.5, 0.5, 1, 0.0, 0.5, [2, 3]],
      # [0.0, 0.5, 0.5, 1, 0.0, 1.0, [2, 3]],
      # [0.0, 0.5, 0.5, 1, 0.5, 0.0, [2, 3]],
      # [0.0, 0.5, 0.5, 1, 0.5, 0.5, [2, 3]],
      # [0.0, 0.5, 0.5, 1, 0.5, 1.0, [2, 3]],
      # [0.0, 0.5, 0.5, 1, 1.0, 0.0, [2, 3]],
      # [0.0, 0.5, 0.5, 1, 1.0, 0.5, [2, 3]],
      # [0.0, 0.5, 0.5, 1, 1.0, 1.0, [2, 3]],
      # [0.0, 0.5, 0.5, 2, 0.0, 0.0, [2, 3]],
      # [0.0, 0.5, 0.5, 2, 0.0, 0.5, [2, 3]],
      # [0.0, 0.5, 0.5, 2, 0.0, 1.0, [2, 3]],
      # [0.0, 0.5, 0.5, 2, 0.5, 0.0, [0, 1]],
      # [0.0, 0.5, 0.5, 2, 0.5, 0.5, [0, 1]],
      # [0.0, 0.5, 0.5, 2, 0.5, 1.0, [0, 1]],
      # [0.0, 0.5, 0.5, 2, 1.0, 0.0, [0, 1]],
      # [0.0, 0.5, 0.5, 2, 1.0, 0.5, [0, 1]],
      # [0.0, 0.5, 0.5, 2, 1.0, 1.0, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 0.0, 0.0, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 0.0, 0.5, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 0.0, 1.0, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 0.5, 0.0, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 0.5, 0.5, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 0.5, 1.0, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 1.0, 0.0, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 1.0, 0.5, [0, 1]],
      # [0.0, 0.5, 1.0, 1, 1.0, 1.0, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 0.0, 0.0, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 0.0, 0.5, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 0.0, 1.0, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 0.5, 0.0, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 0.5, 0.5, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 0.5, 1.0, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 1.0, 0.0, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 1.0, 0.5, [0, 1]],
      # [0.0, 0.5, 1.0, 2, 1.0, 1.0, [0, 1]],
      # [0.0, 1.0, 0.0, 1, 0.0, 0.0, [0, 6]],
      # [0.0, 1.0, 0.0, 1, 0.0, 0.5, [3, 4]],
      # [0.0, 1.0, 0.0, 1, 0.0, 1.0, [3, 4]],
      # [0.0, 1.0, 0.0, 1, 0.5, 0.0, [0, 6]],
      # [0.0, 1.0, 0.0, 1, 0.5, 0.5, [3, 4]],
      # [0.0, 1.0, 0.0, 1, 0.5, 1.0, [3, 4]],
      # [0.0, 1.0, 0.0, 1, 1.0, 0.0, [0, 6]],
      # [0.0, 1.0, 0.0, 1, 1.0, 0.5, [3, 4]],
      # [0.0, 1.0, 0.0, 1, 1.0, 1.0, [3, 4]],
      # [0.0, 1.0, 0.0, 2, 0.0, 0.0, [0, 6]],
      # [0.0, 1.0, 0.0, 2, 0.0, 0.5, [0, 6]],
      # [0.0, 1.0, 0.0, 2, 0.0, 1.0, [0, 6]],
      # [0.0, 1.0, 0.0, 2, 0.5, 0.0, [0, 4]],
      # [0.0, 1.0, 0.0, 2, 0.5, 0.5, [0, 4]],
      # [0.0, 1.0, 0.0, 2, 0.5, 1.0, [0, 4]],
      # [0.0, 1.0, 0.0, 2, 1.0, 0.0, [0, 3]],
      # [0.0, 1.0, 0.0, 2, 1.0, 0.5, [0, 3]],
      # [0.0, 1.0, 0.0, 2, 1.0, 1.0, [0, 3]],
      # [0.0, 1.0, 0.5, 1, 0.0, 0.0, [3, 4]],
      # [0.0, 1.0, 0.5, 1, 0.0, 0.5, [3, 4]],
      # [0.0, 1.0, 0.5, 1, 0.0, 1.0, [3, 4]],
      # [0.0, 1.0, 0.5, 1, 0.5, 0.0, [3, 4]],
      # [0.0, 1.0, 0.5, 1, 0.5, 0.5, [3, 4]],
      # [0.0, 1.0, 0.5, 1, 0.5, 1.0, [3, 4]],
      # [0.0, 1.0, 0.5, 1, 1.0, 0.0, [3, 4]],
      # [0.0, 1.0, 0.5, 1, 1.0, 0.5, [3, 4]],
      # [0.0, 1.0, 0.5, 1, 1.0, 1.0, [3, 4]],
      # [0.0, 1.0, 0.5, 2, 0.0, 0.0, [3, 4]],
      # [0.0, 1.0, 0.5, 2, 0.0, 0.5, [3, 4]],
      # [0.0, 1.0, 0.5, 2, 0.0, 1.0, [3, 4]],
      # [0.0, 1.0, 0.5, 2, 0.5, 0.0, [2, 3]],
      # [0.0, 1.0, 0.5, 2, 0.5, 0.5, [2, 3]],
      # [0.0, 1.0, 0.5, 2, 0.5, 1.0, [2, 3]],
      # [0.0, 1.0, 0.5, 2, 1.0, 0.0, [0, 1]],
      # [0.0, 1.0, 0.5, 2, 1.0, 0.5, [0, 1]],
      # [0.0, 1.0, 0.5, 2, 1.0, 1.0, [0, 1]],
      # [0.0, 1.0, 1.0, 1, 0.0, 0.0, [3, 4]],
      # [0.0, 1.0, 1.0, 1, 0.0, 0.5, [3, 4]],
      # [0.0, 1.0, 1.0, 1, 0.0, 1.0, [3, 4]],
      # [0.0, 1.0, 1.0, 1, 0.5, 0.0, [3, 4]],
      # [0.0, 1.0, 1.0, 1, 0.5, 0.5, [3, 4]],
      # [0.0, 1.0, 1.0, 1, 0.5, 1.0, [3, 4]],
      # [0.0, 1.0, 1.0, 1, 1.0, 0.0, [3, 4]],
      # [0.0, 1.0, 1.0, 1, 1.0, 0.5, [3, 4]],
      # [0.0, 1.0, 1.0, 1, 1.0, 1.0, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 0.0, 0.0, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 0.0, 0.5, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 0.0, 1.0, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 0.5, 0.0, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 0.5, 0.5, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 0.5, 1.0, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 1.0, 0.0, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 1.0, 0.5, [3, 4]],
      # [0.0, 1.0, 1.0, 2, 1.0, 1.0, [3, 4]],
      # [0.5, 0.0, 0.0, 1, 0.0, 0.0, [0, 7]],
      # [0.5, 0.0, 0.0, 1, 0.0, 0.5, [0, 7]],
      # [0.5, 0.0, 0.0, 1, 0.0, 1.0, [0, 7]],
      # [0.5, 0.0, 0.0, 1, 0.5, 0.0, [0, 7]],
      # [0.5, 0.0, 0.0, 1, 0.5, 0.5, [0, 7]],
      # [0.5, 0.0, 0.0, 1, 0.5, 1.0, [0, 7]],
      # [0.5, 0.0, 0.0, 1, 1.0, 0.0, [0, 7]],
      # [0.5, 0.0, 0.0, 1, 1.0, 0.5, [0, 7]],
      # [0.5, 0.0, 0.0, 1, 1.0, 1.0, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 0.0, 0.0, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 0.0, 0.5, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 0.0, 1.0, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 0.5, 0.0, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 0.5, 0.5, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 0.5, 1.0, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 1.0, 0.0, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 1.0, 0.5, [0, 7]],
      # [0.5, 0.0, 0.0, 2, 1.0, 1.0, [0, 7]],
      # [0.5, 0.0, 0.5, 1, 0.0, 0.0, [0, 7]],
      # [0.5, 0.0, 0.5, 1, 0.0, 0.5, [2, 3]],
      # [0.5, 0.0, 0.5, 1, 0.0, 1.0, [2, 3]],
      # [0.5, 0.0, 0.5, 1, 0.5, 0.0, [0, 7]],
      # [0.5, 0.0, 0.5, 1, 0.5, 0.5, [2, 3]],
      # [0.5, 0.0, 0.5, 1, 0.5, 1.0, [2, 3]],
      # [0.5, 0.0, 0.5, 1, 1.0, 0.0, [0, 7]],
      # [0.5, 0.0, 0.5, 1, 1.0, 0.5, [2, 3]],
      # [0.5, 0.0, 0.5, 1, 1.0, 1.0, [2, 3]],
      # [0.5, 0.0, 0.5, 2, 0.0, 0.0, [0, 7]],
      # [0.5, 0.0, 0.5, 2, 0.0, 0.5, [0, 7]],
      # [0.5, 0.0, 0.5, 2, 0.0, 1.0, [0, 7]],
      # [0.5, 0.0, 0.5, 2, 0.5, 0.0, [0, 7]],
      # [0.5, 0.0, 0.5, 2, 0.5, 0.5, [0, 7]],
      # [0.5, 0.0, 0.5, 2, 0.5, 1.0, [0, 7]],
      # [0.5, 0.0, 0.5, 2, 1.0, 0.0, [0, 7]],
      # [0.5, 0.0, 0.5, 2, 1.0, 0.5, [0, 7]],
      # [0.5, 0.0, 0.5, 2, 1.0, 1.0, [0, 7]],
      # [0.5, 0.0, 1.0, 1, 0.0, 0.0, [0, 7]],
      # [0.5, 0.0, 1.0, 1, 0.0, 0.5, [0, 1]],
      # [0.5, 0.0, 1.0, 1, 0.0, 1.0, [0, 1]],
      # [0.5, 0.0, 1.0, 1, 0.5, 0.0, [0, 7]],
      # [0.5, 0.0, 1.0, 1, 0.5, 0.5, [0, 1]],
      # [0.5, 0.0, 1.0, 1, 0.5, 1.0, [0, 1]],
      # [0.5, 0.0, 1.0, 1, 1.0, 0.0, [0, 7]],
      # [0.5, 0.0, 1.0, 1, 1.0, 0.5, [0, 1]],
      # [0.5, 0.0, 1.0, 1, 1.0, 1.0, [0, 1]],
      # [0.5, 0.0, 1.0, 2, 0.0, 0.0, [0, 7]],
      # [0.5, 0.0, 1.0, 2, 0.0, 0.5, [0, 7]],
      # [0.5, 0.0, 1.0, 2, 0.0, 1.0, [0, 7]],
      # [0.5, 0.0, 1.0, 2, 0.5, 0.0, [0, 7]],
      # [0.5, 0.0, 1.0, 2, 0.5, 0.5, [0, 7]],
      # [0.5, 0.0, 1.0, 2, 0.5, 1.0, [0, 7]],
      # [0.5, 0.0, 1.0, 2, 1.0, 0.0, [0, 7]],
      # [0.5, 0.0, 1.0, 2, 1.0, 0.5, [0, 7]],
      # [0.5, 0.0, 1.0, 2, 1.0, 1.0, [0, 7]],
      # [0.5, 0.5, 0.0, 1, 0.0, 0.0, [0, 6]],
      # [0.5, 0.5, 0.0, 1, 0.0, 0.5, [0, 6]],
      # [0.5, 0.5, 0.0, 1, 0.0, 1.0, [0, 1]],
      # [0.5, 0.5, 0.0, 1, 0.5, 0.0, [0, 6]],
      # [0.5, 0.5, 0.0, 1, 0.5, 0.5, [0, 6]],
      # [0.5, 0.5, 0.0, 1, 0.5, 1.0, [0, 1]],
      # [0.5, 0.5, 0.0, 1, 1.0, 0.0, [0, 6]],
      # [0.5, 0.5, 0.0, 1, 1.0, 0.5, [0, 6]],
      # [0.5, 0.5, 0.0, 1, 1.0, 1.0, [0, 1]],
      # [0.5, 0.5, 0.0, 2, 0.0, 0.0, [0, 6]],
      # [0.5, 0.5, 0.0, 2, 0.0, 0.5, [0, 6]],
      # [0.5, 0.5, 0.0, 2, 0.0, 1.0, [0, 6]],
      # [0.5, 0.5, 0.0, 2, 0.5, 0.0, [0, 5]],
      # [0.5, 0.5, 0.0, 2, 0.5, 0.5, [0, 5]],
      # [0.5, 0.5, 0.0, 2, 0.5, 1.0, [0, 5]],
      # [0.5, 0.5, 0.0, 2, 1.0, 0.0, [0, 3]],
      # [0.5, 0.5, 0.0, 2, 1.0, 0.5, [0, 3]],
      # [0.5, 0.5, 0.0, 2, 1.0, 1.0, [0, 3]],
      # [0.5, 0.5, 0.5, 1, 0.0, 0.0, [2, 3]],
      # [0.5, 0.5, 0.5, 1, 0.0, 0.5, [2, 3]],
      # [0.5, 0.5, 0.5, 1, 0.0, 1.0, [2, 3]],
      # [0.5, 0.5, 0.5, 1, 0.5, 0.0, [2, 3]],
      # [0.5, 0.5, 0.5, 1, 0.5, 0.5, [2, 3]],
      # [0.5, 0.5, 0.5, 1, 0.5, 1.0, [2, 3]],
      # [0.5, 0.5, 0.5, 1, 1.0, 0.0, [2, 3]],
      # [0.5, 0.5, 0.5, 1, 1.0, 0.5, [2, 3]],
      # [0.5, 0.5, 0.5, 1, 1.0, 1.0, [2, 3]],
      # [0.5, 0.5, 0.5, 2, 0.0, 0.0, [2, 3]],
      # [0.5, 0.5, 0.5, 2, 0.0, 0.5, [2, 3]],
      # [0.5, 0.5, 0.5, 2, 0.0, 1.0, [2, 3]],
      # [0.5, 0.5, 0.5, 2, 0.5, 0.0, [0, 1]],
      # [0.5, 0.5, 0.5, 2, 0.5, 0.5, [0, 1]],
      # [0.5, 0.5, 0.5, 2, 0.5, 1.0, [0, 1]],
      # [0.5, 0.5, 0.5, 2, 1.0, 0.0, [0, 1]],
      # [0.5, 0.5, 0.5, 2, 1.0, 0.5, [0, 1]],
      # [0.5, 0.5, 0.5, 2, 1.0, 1.0, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 0.0, 0.0, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 0.0, 0.5, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 0.0, 1.0, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 0.5, 0.0, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 0.5, 0.5, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 0.5, 1.0, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 1.0, 0.0, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 1.0, 0.5, [0, 1]],
      # [0.5, 0.5, 1.0, 1, 1.0, 1.0, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 0.0, 0.0, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 0.0, 0.5, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 0.0, 1.0, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 0.5, 0.0, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 0.5, 0.5, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 0.5, 1.0, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 1.0, 0.0, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 1.0, 0.5, [0, 1]],
      # [0.5, 0.5, 1.0, 2, 1.0, 1.0, [0, 1]],
      # [0.5, 1.0, 0.0, 1, 0.0, 0.0, [0, 6]],
      # [0.5, 1.0, 0.0, 1, 0.0, 0.5, [3, 4]],
      # [0.5, 1.0, 0.0, 1, 0.0, 1.0, [3, 4]],
      # [0.5, 1.0, 0.0, 1, 0.5, 0.0, [0, 6]],
      # [0.5, 1.0, 0.0, 1, 0.5, 0.5, [3, 4]],
      # [0.5, 1.0, 0.0, 1, 0.5, 1.0, [3, 4]],
      # [0.5, 1.0, 0.0, 1, 1.0, 0.0, [0, 6]],
      # [0.5, 1.0, 0.0, 1, 1.0, 0.5, [3, 4]],
      # [0.5, 1.0, 0.0, 1, 1.0, 1.0, [3, 4]],
      # [0.5, 1.0, 0.0, 2, 0.0, 0.0, [0, 6]],
      # [0.5, 1.0, 0.0, 2, 0.0, 0.5, [0, 6]],
      # [0.5, 1.0, 0.0, 2, 0.0, 1.0, [0, 6]],
      # [0.5, 1.0, 0.0, 2, 0.5, 0.0, [0, 4]],
      # [0.5, 1.0, 0.0, 2, 0.5, 0.5, [0, 4]],
      # [0.5, 1.0, 0.0, 2, 0.5, 1.0, [0, 4]],
      # [0.5, 1.0, 0.0, 2, 1.0, 0.0, [0, 3]],
      # [0.5, 1.0, 0.0, 2, 1.0, 0.5, [0, 3]],
      # [0.5, 1.0, 0.0, 2, 1.0, 1.0, [0, 3]],
      # [0.5, 1.0, 0.5, 1, 0.0, 0.0, [3, 4]],
      # [0.5, 1.0, 0.5, 1, 0.0, 0.5, [3, 4]],
      # [0.5, 1.0, 0.5, 1, 0.0, 1.0, [3, 4]],
      # [0.5, 1.0, 0.5, 1, 0.5, 0.0, [3, 4]],
      # [0.5, 1.0, 0.5, 1, 0.5, 0.5, [3, 4]],
      # [0.5, 1.0, 0.5, 1, 0.5, 1.0, [3, 4]],
      # [0.5, 1.0, 0.5, 1, 1.0, 0.0, [3, 4]],
      # [0.5, 1.0, 0.5, 1, 1.0, 0.5, [3, 4]],
      # [0.5, 1.0, 0.5, 1, 1.0, 1.0, [3, 4]],
      # [0.5, 1.0, 0.5, 2, 0.0, 0.0, [3, 4]],
      # [0.5, 1.0, 0.5, 2, 0.0, 0.5, [3, 4]],
      # [0.5, 1.0, 0.5, 2, 0.0, 1.0, [3, 4]],
      # [0.5, 1.0, 0.5, 2, 0.5, 0.0, [2, 3]],
      # [0.5, 1.0, 0.5, 2, 0.5, 0.5, [2, 3]],
      # [0.5, 1.0, 0.5, 2, 0.5, 1.0, [2, 3]],
      # [0.5, 1.0, 0.5, 2, 1.0, 0.0, [0, 1]],
      # [0.5, 1.0, 0.5, 2, 1.0, 0.5, [0, 1]],
      # [0.5, 1.0, 0.5, 2, 1.0, 1.0, [0, 1]],
      # [0.5, 1.0, 1.0, 1, 0.0, 0.0, [3, 4]],
      # [0.5, 1.0, 1.0, 1, 0.0, 0.5, [3, 4]],
      # [0.5, 1.0, 1.0, 1, 0.0, 1.0, [3, 4]],
      # [0.5, 1.0, 1.0, 1, 0.5, 0.0, [3, 4]],
      # [0.5, 1.0, 1.0, 1, 0.5, 0.5, [3, 4]],
      # [0.5, 1.0, 1.0, 1, 0.5, 1.0, [3, 4]],
      # [0.5, 1.0, 1.0, 1, 1.0, 0.0, [3, 4]],
      # [0.5, 1.0, 1.0, 1, 1.0, 0.5, [3, 4]],
      # [0.5, 1.0, 1.0, 1, 1.0, 1.0, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 0.0, 0.0, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 0.0, 0.5, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 0.0, 1.0, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 0.5, 0.0, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 0.5, 0.5, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 0.5, 1.0, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 1.0, 0.0, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 1.0, 0.5, [3, 4]],
      # [0.5, 1.0, 1.0, 2, 1.0, 1.0, [3, 4]],
      # [1.0, 0.0, 0.0, 1, 0.0, 0.0, [0, 7]],
      # [1.0, 0.0, 0.0, 1, 0.0, 0.5, [0, 7]],
      # [1.0, 0.0, 0.0, 1, 0.0, 1.0, [0, 7]],
      # [1.0, 0.0, 0.0, 1, 0.5, 0.0, [0, 7]],
      # [1.0, 0.0, 0.0, 1, 0.5, 0.5, [0, 7]],
      # [1.0, 0.0, 0.0, 1, 0.5, 1.0, [0, 7]],
      # [1.0, 0.0, 0.0, 1, 1.0, 0.0, [0, 7]],
      # [1.0, 0.0, 0.0, 1, 1.0, 0.5, [0, 7]],
      # [1.0, 0.0, 0.0, 1, 1.0, 1.0, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 0.0, 0.0, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 0.0, 0.5, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 0.0, 1.0, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 0.5, 0.0, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 0.5, 0.5, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 0.5, 1.0, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 1.0, 0.0, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 1.0, 0.5, [0, 7]],
      # [1.0, 0.0, 0.0, 2, 1.0, 1.0, [0, 7]],
      # [1.0, 0.0, 0.5, 1, 0.0, 0.0, [0, 7]],
      # [1.0, 0.0, 0.5, 1, 0.0, 0.5, [2, 3]],
      # [1.0, 0.0, 0.5, 1, 0.0, 1.0, [2, 3]],
      # [1.0, 0.0, 0.5, 1, 0.5, 0.0, [0, 7]],
      # [1.0, 0.0, 0.5, 1, 0.5, 0.5, [2, 3]],
      # [1.0, 0.0, 0.5, 1, 0.5, 1.0, [2, 3]],
      # [1.0, 0.0, 0.5, 1, 1.0, 0.0, [0, 7]],
      # [1.0, 0.0, 0.5, 1, 1.0, 0.5, [2, 3]],
      # [1.0, 0.0, 0.5, 1, 1.0, 1.0, [2, 3]],
      # [1.0, 0.0, 0.5, 2, 0.0, 0.0, [0, 7]],
      # [1.0, 0.0, 0.5, 2, 0.0, 0.5, [0, 7]],
      # [1.0, 0.0, 0.5, 2, 0.0, 1.0, [0, 7]],
      # [1.0, 0.0, 0.5, 2, 0.5, 0.0, [0, 7]],
      # [1.0, 0.0, 0.5, 2, 0.5, 0.5, [0, 7]],
      # [1.0, 0.0, 0.5, 2, 0.5, 1.0, [0, 7]],
      # [1.0, 0.0, 0.5, 2, 1.0, 0.0, [0, 7]],
      # [1.0, 0.0, 0.5, 2, 1.0, 0.5, [0, 7]],
      # [1.0, 0.0, 0.5, 2, 1.0, 1.0, [0, 7]],
      # [1.0, 0.0, 1.0, 1, 0.0, 0.0, [0, 7]],
      # [1.0, 0.0, 1.0, 1, 0.0, 0.5, [0, 1]],
      # [1.0, 0.0, 1.0, 1, 0.0, 1.0, [0, 1]],
      # [1.0, 0.0, 1.0, 1, 0.5, 0.0, [0, 7]],
      # [1.0, 0.0, 1.0, 1, 0.5, 0.5, [0, 1]],
      # [1.0, 0.0, 1.0, 1, 0.5, 1.0, [0, 1]],
      # [1.0, 0.0, 1.0, 1, 1.0, 0.0, [0, 7]],
      # [1.0, 0.0, 1.0, 1, 1.0, 0.5, [0, 1]],
      # [1.0, 0.0, 1.0, 1, 1.0, 1.0, [0, 1]],
      # [1.0, 0.0, 1.0, 2, 0.0, 0.0, [0, 7]],
      # [1.0, 0.0, 1.0, 2, 0.0, 0.5, [0, 7]],
      # [1.0, 0.0, 1.0, 2, 0.0, 1.0, [0, 7]],
      # [1.0, 0.0, 1.0, 2, 0.5, 0.0, [0, 7]],
      # [1.0, 0.0, 1.0, 2, 0.5, 0.5, [0, 7]],
      # [1.0, 0.0, 1.0, 2, 0.5, 1.0, [0, 7]],
      # [1.0, 0.0, 1.0, 2, 1.0, 0.0, [0, 7]],
      # [1.0, 0.0, 1.0, 2, 1.0, 0.5, [0, 7]],
      # [1.0, 0.0, 1.0, 2, 1.0, 1.0, [0, 7]],
      # [1.0, 0.5, 0.0, 1, 0.0, 0.0, [0, 6]],
      # [1.0, 0.5, 0.0, 1, 0.0, 0.5, [0, 6]],
      # [1.0, 0.5, 0.0, 1, 0.0, 1.0, [0, 1]],
      # [1.0, 0.5, 0.0, 1, 0.5, 0.0, [0, 6]],
      # [1.0, 0.5, 0.0, 1, 0.5, 0.5, [0, 6]],
      # [1.0, 0.5, 0.0, 1, 0.5, 1.0, [0, 1]],
      # [1.0, 0.5, 0.0, 1, 1.0, 0.0, [0, 6]],
      # [1.0, 0.5, 0.0, 1, 1.0, 0.5, [0, 6]],
      # [1.0, 0.5, 0.0, 1, 1.0, 1.0, [0, 1]],
      # [1.0, 0.5, 0.0, 2, 0.0, 0.0, [0, 6]],
      # [1.0, 0.5, 0.0, 2, 0.0, 0.5, [0, 6]],
      # [1.0, 0.5, 0.0, 2, 0.0, 1.0, [0, 6]],
      # [1.0, 0.5, 0.0, 2, 0.5, 0.0, [0, 5]],
      # [1.0, 0.5, 0.0, 2, 0.5, 0.5, [0, 5]],
      # [1.0, 0.5, 0.0, 2, 0.5, 1.0, [0, 5]],
      # [1.0, 0.5, 0.0, 2, 1.0, 0.0, [0, 3]],
      # [1.0, 0.5, 0.0, 2, 1.0, 0.5, [0, 3]],
      # [1.0, 0.5, 0.0, 2, 1.0, 1.0, [0, 3]],
      # [1.0, 0.5, 0.5, 1, 0.0, 0.0, [2, 3]],
      # [1.0, 0.5, 0.5, 1, 0.0, 0.5, [2, 3]],
      # [1.0, 0.5, 0.5, 1, 0.0, 1.0, [2, 3]],
      # [1.0, 0.5, 0.5, 1, 0.5, 0.0, [2, 3]],
      # [1.0, 0.5, 0.5, 1, 0.5, 0.5, [2, 3]],
      # [1.0, 0.5, 0.5, 1, 0.5, 1.0, [2, 3]],
      # [1.0, 0.5, 0.5, 1, 1.0, 0.0, [2, 3]],
      # [1.0, 0.5, 0.5, 1, 1.0, 0.5, [2, 3]],
      # [1.0, 0.5, 0.5, 1, 1.0, 1.0, [2, 3]],
      # [1.0, 0.5, 0.5, 2, 0.0, 0.0, [2, 3]],
      # [1.0, 0.5, 0.5, 2, 0.0, 0.5, [2, 3]],
      # [1.0, 0.5, 0.5, 2, 0.0, 1.0, [2, 3]],
      # [1.0, 0.5, 0.5, 2, 0.5, 0.0, [0, 1]],
      # [1.0, 0.5, 0.5, 2, 0.5, 0.5, [0, 1]],
      # [1.0, 0.5, 0.5, 2, 0.5, 1.0, [0, 1]],
      # [1.0, 0.5, 0.5, 2, 1.0, 0.0, [0, 1]],
      # [1.0, 0.5, 0.5, 2, 1.0, 0.5, [0, 1]],
      # [1.0, 0.5, 0.5, 2, 1.0, 1.0, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 0.0, 0.0, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 0.0, 0.5, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 0.0, 1.0, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 0.5, 0.0, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 0.5, 0.5, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 0.5, 1.0, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 1.0, 0.0, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 1.0, 0.5, [0, 1]],
      # [1.0, 0.5, 1.0, 1, 1.0, 1.0, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 0.0, 0.0, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 0.0, 0.5, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 0.0, 1.0, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 0.5, 0.0, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 0.5, 0.5, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 0.5, 1.0, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 1.0, 0.0, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 1.0, 0.5, [0, 1]],
      # [1.0, 0.5, 1.0, 2, 1.0, 1.0, [0, 1]],
      # [1.0, 1.0, 0.0, 1, 0.0, 0.0, [0, 6]],
      # [1.0, 1.0, 0.0, 1, 0.0, 0.5, [3, 4]],
      # [1.0, 1.0, 0.0, 1, 0.0, 1.0, [3, 4]],
      # [1.0, 1.0, 0.0, 1, 0.5, 0.0, [0, 6]],
      # [1.0, 1.0, 0.0, 1, 0.5, 0.5, [3, 4]],
      # [1.0, 1.0, 0.0, 1, 0.5, 1.0, [3, 4]],
      # [1.0, 1.0, 0.0, 1, 1.0, 0.0, [0, 6]],
      # [1.0, 1.0, 0.0, 1, 1.0, 0.5, [3, 4]],
      # [1.0, 1.0, 0.0, 1, 1.0, 1.0, [3, 4]],
      # [1.0, 1.0, 0.0, 2, 0.0, 0.0, [0, 6]],
      # [1.0, 1.0, 0.0, 2, 0.0, 0.5, [0, 6]],
      # [1.0, 1.0, 0.0, 2, 0.0, 1.0, [0, 6]],
      # [1.0, 1.0, 0.0, 2, 0.5, 0.0, [0, 4]],
      # [1.0, 1.0, 0.0, 2, 0.5, 0.5, [0, 4]],
      # [1.0, 1.0, 0.0, 2, 0.5, 1.0, [0, 4]],
      # [1.0, 1.0, 0.0, 2, 1.0, 0.0, [0, 3]],
      # [1.0, 1.0, 0.0, 2, 1.0, 0.5, [0, 3]],
      # [1.0, 1.0, 0.0, 2, 1.0, 1.0, [0, 3]],
      # [1.0, 1.0, 0.5, 1, 0.0, 0.0, [3, 4]],
      # [1.0, 1.0, 0.5, 1, 0.0, 0.5, [3, 4]],
      # [1.0, 1.0, 0.5, 1, 0.0, 1.0, [3, 4]],
      # [1.0, 1.0, 0.5, 1, 0.5, 0.0, [3, 4]],
      # [1.0, 1.0, 0.5, 1, 0.5, 0.5, [3, 4]],
      # [1.0, 1.0, 0.5, 1, 0.5, 1.0, [3, 4]],
      # [1.0, 1.0, 0.5, 1, 1.0, 0.0, [3, 4]],
      # [1.0, 1.0, 0.5, 1, 1.0, 0.5, [3, 4]],
      # [1.0, 1.0, 0.5, 1, 1.0, 1.0, [3, 4]],
      # [1.0, 1.0, 0.5, 2, 0.0, 0.0, [3, 4]],
      # [1.0, 1.0, 0.5, 2, 0.0, 0.5, [3, 4]],
      # [1.0, 1.0, 0.5, 2, 0.0, 1.0, [3, 4]],
      # [1.0, 1.0, 0.5, 2, 0.5, 0.0, [2, 3]],
      # [1.0, 1.0, 0.5, 2, 0.5, 0.5, [2, 3]],
      # [1.0, 1.0, 0.5, 2, 0.5, 1.0, [2, 3]],
      # [1.0, 1.0, 0.5, 2, 1.0, 0.0, [0, 1]],
      # [1.0, 1.0, 0.5, 2, 1.0, 0.5, [0, 1]],
      # [1.0, 1.0, 0.5, 2, 1.0, 1.0, [0, 1]],
      # [1.0, 1.0, 1.0, 1, 0.0, 0.0, [3, 4]],
      # [1.0, 1.0, 1.0, 1, 0.0, 0.5, [3, 4]],
      # [1.0, 1.0, 1.0, 1, 0.0, 1.0, [3, 4]],
      # [1.0, 1.0, 1.0, 1, 0.5, 0.0, [3, 4]],
      # [1.0, 1.0, 1.0, 1, 0.5, 0.5, [3, 4]],
      # [1.0, 1.0, 1.0, 1, 0.5, 1.0, [3, 4]],
      # [1.0, 1.0, 1.0, 1, 1.0, 0.0, [3, 4]],
      # [1.0, 1.0, 1.0, 1, 1.0, 0.5, [3, 4]],
      # [1.0, 1.0, 1.0, 1, 1.0, 1.0, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 0.0, 0.0, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 0.0, 0.5, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 0.0, 1.0, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 0.5, 0.0, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 0.5, 0.5, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 0.5, 1.0, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 1.0, 0.0, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 1.0, 0.5, [3, 4]],
      # [1.0, 1.0, 1.0, 2, 1.0, 1.0, [3, 4]],
    ].each do |cont, glob, cent, grp, div, conc, expected|
      it "generates #{expected} for params #{[cont, glob, cent, grp, div, conc]}" do
        params = {
          generate_polyphonic: {
            job_id: job_id,
            initial_octaves: initial_octaves,
            stream_counts: stream_counts,
            target_continuations:     [cont],
            global_complexity:        [glob],
            stream_complexity_center: [cent],
            complexity_group_count:   [grp],
            complexity_diversity:     [div],
            group_concordance:        [conc]
          }
        }

        post :generate_polyphonic, params: params, as: :json

        json = JSON.parse(response.body)
        # json['timeSeries'] は [[0,7], [0,7], [0,7], [RESULT]] となるので last を取る
        expect(json['timeSeries'].last).to eq(expected)
      end
    end
  end
end
